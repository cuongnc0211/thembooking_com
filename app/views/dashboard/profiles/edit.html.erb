<div class="max-w-2xl mx-auto mt-8 px-4">
  <h1 class="text-3xl font-bold mb-6">Account Settings</h1>

  <%= form_with model: @user, url: dashboard_profile_path, method: :patch, class: "space-y-6" do |form| %>
    <% if @user.errors.any? %>
      <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
        <ul class="list-disc list-inside">
          <% @user.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Avatar Upload -->
    <div data-controller="image-preview">
      <label class="block text-sm font-medium text-gray-700 mb-2">Profile Photo</label>

      <div class="flex items-center space-x-4">
        <% if @user.avatar.attached? %>
          <%= image_tag @user.avatar.variant(resize_to_limit: [200, 200]), class: "h-24 w-24 rounded-full object-cover", data: { image_preview_target: "preview" } %>
        <% else %>
          <div class="relative h-24 w-24">
            <div class="h-24 w-24 rounded-full bg-gray-200 flex items-center justify-center">
              <span class="text-4xl text-gray-400">?</span>
            </div>
            <%= image_tag "", class: "h-24 w-24 rounded-full object-cover absolute top-0 left-0 hidden", data: { image_preview_target: "preview" } %>
          </div>
        <% end %>

        <%= form.file_field :avatar,
            class: "hidden",
            id: "avatar-upload",
            accept: "image/jpeg,image/png,image/gif",
            data: {
              image_preview_target: "input",
              action: "change->image-preview#preview"
            } %>
        <label for="avatar-upload" class="cursor-pointer bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50">
          <%= @user.avatar.attached? ? "Change Photo" : "Upload Photo" %>
        </label>
      </div>
      <p class="mt-2 text-sm text-gray-500">JPG, PNG, or GIF. Max 5MB.</p>
    </div>

    <!-- Name -->
    <div>
      <%= form.label :name, class: "form-label" %>
      <%= form.text_field :name, class: "form-input" %>
    </div>

    <!-- Email -->
    <div>
      <%= form.label :email_address, "Email", class: "form-label" %>
      <%= form.email_field :email_address, class: "form-input" %>
      <% if @user.confirmed? %>
        <p class="mt-1 text-sm text-green-600">âœ“ Verified</p>
      <% else %>
        <p class="mt-1 text-sm text-yellow-600">! Not verified</p>
      <% end %>
    </div>

    <!-- Phone -->
    <div>
      <%= form.label :phone, class: "form-label" %>
      <%= form.telephone_field :phone, class: "form-input" %>
      <p class="form-helper-text">Optional. Include country code (e.g., +84 for Vietnam)</p>
    </div>

    <!-- Time Zone -->
    <div>
      <%= form.label :time_zone, class: "form-label" %>
      <%= form.time_zone_select :time_zone,
            ActiveSupport::TimeZone.all,
            { default: @user.time_zone || "Hanoi" },
            class: "form-select" %>
      <p class="form-helper-text">Used to display booking times in your local timezone</p>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end">
      <%= form.submit "Save Changes", class: "bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
    </div>
  <% end %>

  <!-- Password Change Section -->
  <div class="mt-8 pt-8 border-t border-gray-200">
    <h2 class="text-xl font-semibold mb-4">Change Password</h2>
    <%= link_to "Reset Password", new_password_path, class: "text-blue-600 hover:text-blue-500" %>
  </div>
</div>
